import streamlit as st
import random

# ìš´ë™ í”„ë¡œê·¸ëž¨ ë° ê°€ê²©(ë‹¨ìœ„: ì›)
programs = {
    "ìˆ˜ì˜": {"1íšŒê¶Œ": 7000, "ì •ê¸°ê¶Œ": 62000, "íŒ¨í‚¤ì§€": 136000},
    "í—¬ìŠ¤": {"1íšŒê¶Œ": 9000, "ì •ê¸°ê¶Œ": 79000, "íŒ¨í‚¤ì§€": 105000},
    "ìŠ¤ì¿¼ì‹œ": {"1íšŒê¶Œ": 10000, "ì •ê¸°ê¶Œ": 82000},
    "ì²´í˜• êµì • ë°œë ˆ": {"ì •ê¸°ê¶Œ": 90000},
    "ë°©ì†¡ëŒ„ìŠ¤": {"ì •ê¸°ê¶Œ": 90000},
    "ê³¨í”„": {"1íšŒê¶Œ": 10000, "ì •ê¸°ê¶Œ": 119000}
}

mbti_recommendations = {
    "ISTJ": "ìŠ¤ì¿¼ì‹œ", "ISFJ": "ì²´í˜• êµì • ë°œë ˆ", "INFJ": "ìˆ˜ì˜", "INTJ": "ê³¨í”„",
    "ISTP": "ìŠ¤ì¿¼ì‹œ", "ISFP": "ë°©ì†¡ëŒ„ìŠ¤", "INFP": "ì²´í˜• êµì • ë°œë ˆ", "INTP": "ê³¨í”„",
    "ESTP": "í—¬ìŠ¤", "ESFP": "ë°©ì†¡ëŒ„ìŠ¤", "ENFP": "ë°©ì†¡ëŒ„ìŠ¤", "ENTP": "ê³¨í”„",
    "ESTJ": "í—¬ìŠ¤", "ESFJ": "ìˆ˜ì˜", "ENFJ": "ë°©ì†¡ëŒ„ìŠ¤", "ENTJ": "ê³¨í”„"
}

mbti_explanations = {
    "ISTJ": "ê·œì¹™ì ì´ê³  ì²´ê³„ì ì¸ ìŠ¤ì¿¼ì‹œì˜ ëª…í™•í•œ ë£°ì´ ë‹¹ì‹ ì˜ ì„±í–¥ê³¼ ìž˜ ë§žìŠµë‹ˆë‹¤.",
    "ISFJ": "ì„¸ì‹¬í•œ ë™ìž‘ êµì •ì´ í•„ìš”í•œ ë°œë ˆê°€ ë‚´ì„±ì ì´ë©´ì„œ ì™„ë²½ì£¼ì˜ì ì¸ ì„±í–¥ì— ì í•©í•©ë‹ˆë‹¤.",
    "INFJ": "í˜¼ìžì„œ ì§‘ì¤‘í•  ìˆ˜ ìžˆëŠ” ìˆ˜ì˜ì´ ë‚´í–¥ì ì´ë©´ì„œë„ í†µì°°ë ¥ ìžˆëŠ” ì„±ê²©ê³¼ ì¡°í™”ë¡­ìŠµë‹ˆë‹¤.",
    "INTJ": "ì „ëžµì  ì‚¬ê³ ê°€ í•„ìš”í•œ ê³¨í”„ê°€ ë¹„ì „ì„ ì¤‘ì‹œí•˜ëŠ” ë‹¹ì‹ ì˜ ì„±í–¥ì— ë¶€í•©í•©ë‹ˆë‹¤.",
    "ISTP": "ìˆœê°„ íŒë‹¨ê³¼ ê¸°ê³„ì  ì›€ì§ìž„ì´ ì¤‘ìš”í•œ ìŠ¤ì¿¼ì‹œê°€ ë¶„ì„ì  ì„±í–¥ê³¼ ìž˜ ë§žìŠµë‹ˆë‹¤.",
    "ISFP": "ì˜ˆìˆ ì  í‘œí˜„ì´ ìžìœ ë¡œìš´ ë°©ì†¡ëŒ„ìŠ¤ê°€ ê°ì„±ì ì¸ ì„±ê²©ì— ìµœì í™”ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.",
    "INFP": "ì•„ë¦„ë‹¤ì›€ê³¼ ì¡°í™”ë¥¼ ì¶”êµ¬í•˜ëŠ” ë°œë ˆê°€ ì´ìƒì£¼ì˜ì  ì„±í–¥ê³¼ ìž˜ ì–´ìš¸ë¦½ë‹ˆë‹¤.",
    "INTP": "ë¬¼ë¦¬í•™ì  ì›ë¦¬ ë¶„ì„ì´ ê°€ëŠ¥í•œ ê³¨í”„ê°€ ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ê°€ì§„ ë¶„ì—ê²Œ ì í•©í•©ë‹ˆë‹¤.",
    "ESTP": "ì—ë„ˆì§€ ë°œì‚°ì´ ê°€ëŠ¥í•œ ê³ ê°•ë„ í—¬ìŠ¤ê°€ í™œë™ì ì¸ ì„±ê²©ì— ë§žìŠµë‹ˆë‹¤.",
    "ESFP": "ì‚¬êµì ì´ê³  í™œê¸°ì°¬ ë°©ì†¡ëŒ„ìŠ¤ê°€ ì‚¬ëžŒì„ ì¦ê²ê²Œ í•˜ëŠ” ì„±í–¥ê³¼ ì¡°í™”ë¡­ìŠµë‹ˆë‹¤.",
    "ENFP": "ì°½ì˜ë ¥ ë°œíœ˜ê°€ ê°€ëŠ¥í•œ ìžìœ ë¡œìš´ ëŒ„ìŠ¤ê°€ ì—´ì •ì ì¸ ì„±ê²©ì— ì–´ìš¸ë¦½ë‹ˆë‹¤.",
    "ENTP": "ë‹¤ì–‘í•œ ì „ëžµ ì‹œë„ê°€ ê°€ëŠ¥í•œ ê³¨í”„ê°€ í˜ì‹ ì ì¸ ì‚¬ê³ ë¥¼ ê°€ì§„ ë¶„ì—ê²Œ ì¶”ì²œë©ë‹ˆë‹¤.",
    "ESTJ": "ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì²´ê³„ì ì¸ í—¬ìŠ¤ ë£¨í‹´ì´ ì¡°ì§ì ì¸ ì„±í–¥ì— ë¶€í•©í•©ë‹ˆë‹¤.",
    "ESFJ": "ê·¸ë£¹ ìˆ˜ì˜ì´ ì‚¬êµì ì´ë©´ì„œë„ íƒ€ì¸ì„ ë°°ë ¤í•˜ëŠ” ì„±ê²©ê³¼ ìž˜ ë§žìŠµë‹ˆë‹¤.",
    "ENFJ": "íŒ€ì›Œí¬ê°€ ì¤‘ìš”í•œ ë°©ì†¡ëŒ„ìŠ¤ê°€ ë¦¬ë”ì‹­ ìžˆëŠ” ì„±í–¥ì— ì í•©í•©ë‹ˆë‹¤.",
    "ENTJ": "ê²½ìŸì  ìš”ì†Œê°€ ìžˆëŠ” ê³¨í”„ê°€ ëª©í‘œ ì§€í–¥ì ì¸ ì„±ê²©ê³¼ ìž˜ ì–´ìš¸ë¦½ë‹ˆë‹¤."
}

purpose_recommendations = {
    "ì²´ì¤‘ ê°ëŸ‰": ["ìˆ˜ì˜", "í—¬ìŠ¤", "ë°©ì†¡ëŒ„ìŠ¤"],
    "ê·¼ìœ¡ ì¦ê°€": ["í—¬ìŠ¤", "ìŠ¤ì¿¼ì‹œ"],
    "ìžì„¸ ê°œì„ ": ["ì²´í˜• êµì • ë°œë ˆ", "ìˆ˜ì˜"],
    "ìŠ¤íŠ¸ë ˆìŠ¤ í•´ì†Œ": ["ìˆ˜ì˜", "ë°©ì†¡ëŒ„ìŠ¤", "ê³¨í”„"],
    "ìž¬í™œ í›ˆë ¨": ["ìˆ˜ì˜", "ì²´í˜• êµì • ë°œë ˆ"],
    "ì‹¬í ê¸°ëŠ¥ í–¥ìƒ": ["ìˆ˜ì˜", "í—¬ìŠ¤", "ìŠ¤ì¿¼ì‹œ"],
    "ì‚¬êµ í™œë™": ["ë°©ì†¡ëŒ„ìŠ¤", "í—¬ìŠ¤"]
}

sport_tips = {
    "ìˆ˜ì˜": ["ëª© í†µì¦: ì ‘í˜• ì˜ë²•(ë‚˜ë¹„ìˆ˜ì˜)ì€ ëª©ì— ë¶€ë‹´ì„ ì¤„ ìˆ˜ ìžˆìŒ",
             "ì–´ê¹¨ í†µì¦: ê³¼ë„í•œ íŒ” ë™ìž‘ì€ íšŒì „ê·¼ê°œ ì†ìƒ ìœ ë°œ ê°€ëŠ¥",
             "í—ˆë¦¬ í†µì¦: ë°°ì˜ì´ í—ˆë¦¬ì— ê°€ìž¥ ë¶€ë‹´ì´ ì ì€ ì˜ë²•",
             "ë¬´ë¦Ž í†µì¦: í‰ì˜ ë°œì°¨ê¸° ì‹œ ë¬´ë¦Žì— ê³¼ë„í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ì£¼ì˜"],
    "í—¬ìŠ¤": ["ëª© í†µì¦: ëª© ê·¼ìœ¡ ê¸´ìž¥ ìƒíƒœì—ì„œì˜ ë¨¸ë¦¬ ìˆ™ìž„ ë™ìž‘ ê¸ˆì§€",
             "ì–´ê¹¨ í†µì¦: ë²¤ì¹˜ í”„ë ˆìŠ¤ ì‹œ ì–´ê¹¨ ê°ë„ 75ë„ ìœ ì§€",
             "í—ˆë¦¬ í†µì¦: ë°ë“œë¦¬í”„íŠ¸ ì‹œ í—ˆë¦¬ ê³¡ì„  ìœ ì§€ í•„ìˆ˜",
             "ë¬´ë¦Ž í†µì¦: ìŠ¤ì¿¼íŠ¸ ì‹œ ë¬´ë¦Žì´ ë°œë ë„˜ì–´ê°€ì§€ ì•Šë„ë¡"],
    "ìŠ¤ì¿¼ì‹œ": ["ëª© í†µì¦: ê³µì„ ì«“ì„ ë•Œ ëª©ì˜ ê¸‰ê²©í•œ íšŒì „ í”¼í•˜ê¸°",
               "ì–´ê¹¨ í†µì¦: ë°±í•¸ë“œ ìŠ¤íŠ¸ë¡œí¬ ì‹œ ì–´ê¹¨ ê´€ì ˆ ê³¼ì‹ ì „ ì£¼ì˜",
               "í—ˆë¦¬ í†µì¦: ì „ë°© êµ½íž˜ ìžì„¸ ì§€ì† ì‹œ ìš”ì¶” ë””ìŠ¤í¬ ì••ë ¥ â†‘",
               "ë¬´ë¦Ž í†µì¦: ê°‘ìž‘ìŠ¤ëŸ¬ìš´ ë°©í–¥ ì „í™˜ ì‹œ ë¬´ë¦Ž ì¶©ê²© ì¡°ì‹¬"],
    "ì²´í˜• êµì • ë°œë ˆ": ["ëª© í†µì¦: ì•„ë¼ë² ìŠ¤í¬ ìžì„¸ì—ì„œ ëª© ê³¼ë„í•œ ì‹ ì „ ê¸ˆì§€",
                     "ì–´ê¹¨ í†µì¦: í¬ë¥´ ë“œ ë¸Œë¼ ë™ìž‘ ì‹œ ì–´ê¹¨ ë¼ì¸ ìœ ì§€",
                     "í—ˆë¦¬ í†µì¦: í”Œë¦¬ì— ë™ìž‘ì—ì„œ ê³¼ë„í•œ ìš”ì¶” ì „ë§Œ ë°©ì§€",
                     "ë¬´ë¦Ž í†µì¦: í„´ì•„ì›ƒ ê°ë„ ë¬´ë¦¬í•˜ê²Œ í™•ëŒ€í•˜ì§€ ë§ ê²ƒ"],
    "ë°©ì†¡ëŒ„ìŠ¤": ["ëª© í†µì¦: í—¤ë“œë±…ìž‰ ë™ìž‘ì€ ê²½ì¶” ì¶”ê°„íŒ ì†ìƒ ìœ„í—˜",
               "ì–´ê¹¨ í†µì¦: íŒŒíŠ¸ë„ˆ ë¦¬í”„íŒ… ì‹œ íšŒì „ê·¼ê°œ ë¶€ìƒ ì£¼ì˜",
               "í—ˆë¦¬ í†µì¦: íž™í•© ë™ìž‘ ì‹œ ì²™ì¶”ì˜ ë¹„ì •ìƒì  íšŒì „ ê¸ˆì§€",
               "ë¬´ë¦Ž í†µì¦: ì í”„ í›„ ì°©ì§€ ì‹œ ì¶©ê²© í¡ìˆ˜ í•„ìˆ˜"],
    "ê³¨í”„": ["ëª© í†µì¦: ìŠ¤ìœ™ ì‹œ ëª©ì˜ ê³¼ë„í•œ íšŒì „ ë°˜ë³µ ê¸ˆì§€",
             "ì–´ê¹¨ í†µì¦: ë°±ìŠ¤ìœ™ íƒ‘ ìœ„ì¹˜ì—ì„œ ì–´ê¹¨ ê´€ì ˆ ì••ë ¥ â†‘",
             "í—ˆë¦¬ í†µì¦: í‹°ìƒ· ì‹œ ì „ë°© êµ½íž˜ ìžì„¸ ìœ ì§€ ì‹œê°„ ìµœì†Œí™”",
             "ë¬´ë¦Ž í†µì¦: ë‹¤ìš´ìŠ¤ìœ™ ì‹œ ì•žë¬´ë¦Žì˜ ì™¸íšŒì „ ìŠ¤íŠ¸ë ˆìŠ¤ ì£¼ì˜"]
}

st.set_page_config(page_title="SNU ìš´ë™ ì¶”ì²œê¸°", page_icon="ðŸ‹ï¸")
st.title(":muscle: ë” ê±´ê°•í•œ ìº í¼ìŠ¤ë¥¼ ìœ„í•œ ìš´ë™ ì¶”ì²œ í”„ë¡œê·¸ëž¨")
st.markdown("ì„œìš¸ëŒ€í•™êµ êµ¬ì„±ì› ì „ìš© ì„œë¹„ìŠ¤ìž…ë‹ˆë‹¤.")

is_member = st.radio("ì„œìš¸ëŒ€í•™êµ êµ¬ì„±ì›ì´ì‹ ê°€ìš”?", ["ì˜ˆ", "ì•„ë‹ˆì˜¤"])
if is_member == "ì•„ë‹ˆì˜¤":
    st.warning("â€» ë³¸ ì¶”ì²œ ì‹œìŠ¤í…œì€ ì„œìš¸ëŒ€ ê¸°ì¤€ ê°€ê²©ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.")
    if not st.checkbox("ê·¸ëž˜ë„ ê³„ì†í•˜ê² ìŠµë‹ˆë‹¤."):
        st.stop()

method = st.selectbox("ìš´ë™ ì¶”ì²œ ë°©ì‹", ["ì™„ì „ ë¬´ìž‘ìœ„", "MBTI ê¸°ë°˜", "ìš´ë™ ëª©ì  ê¸°ë°˜", "ì§ì ‘ ì„ íƒ"])
budget = st.slider("ìš´ë™ ì˜ˆì‚°ì„ ìž…ë ¥í•˜ì„¸ìš” (ë‹¨ìœ„: ì›)", 5000, 200000, 7000, step=1000)

st.header("ðŸ§â€â™€ï¸ BMI ì¸¡ì •í•˜ê¸° (ì„ íƒì‚¬í•­)")

height = st.number_input("í‚¤ë¥¼ ìž…ë ¥í•˜ì„¸ìš” (ë‹¨ìœ„: m)", min_value=1.0, max_value=2.5, step=0.01)
weight = st.number_input("ëª¸ë¬´ê²Œë¥¼ ìž…ë ¥í•˜ì„¸ìš” (ë‹¨ìœ„: kg)", min_value=30.0, max_value=200.0, step=0.1)

if height > 0 and weight > 0:
    bmi = weight / (height ** 2)
    st.write(f"**BMI ê°’:** {bmi:.1f}")

    if bmi < 18.5:
        st.warning("ì €ì²´ì¤‘ìž…ë‹ˆë‹¤. ìš´ë™í•˜ì‹œê¸° ì „, ë³´ê±´ì§„ë£Œì†Œ ì²´ì¤‘ì¡°ì ˆ í”„ë¡œê·¸ëž¨ì— ë„ì›€ì„ ë°›ìœ¼ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. â˜Žï¸ ì„œìš¸ëŒ€í•™êµ ë³´ê±´ì§„ë£Œì†Œ ì—°ë½ì²˜: 02-880-5338")
    elif 18.5 <= bmi <= 24:
        st.success("ì •ìƒ ì²´ì¤‘ìž…ë‹ˆë‹¤. ìš´ë™ì„ ê²¬ì§€í•˜ì‹œê³  ì²´ì¤‘ ê³„ì† ìœ ì§€í•˜ì‹œê¸° ë°”ëžë‹ˆë‹¤. ðŸ‘")
    else:
        st.warning("ê³¼ì²´ì¤‘ì´ê±°ë‚˜ ë¹„ë§Œì¼ ê°€ëŠ¥ì„±ì´ ìžˆìŠµë‹ˆë‹¤. ìš´ë™í•˜ì‹œê¸° ì „, ë³´ê±´ì§„ë£Œì†Œ ë¹„ë§Œí´ë¦¬ë‹‰ì— ë¬¸ì˜í•˜ì‹œê³  ì „ë¬¸ì ì¸ í”¼ë“œë°± ë°›ìœ¼ì‹œëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. â˜Žï¸ ì„œìš¸ëŒ€í•™êµ ë³´ê±´ì§„ë£Œì†Œ ì—°ë½ì²˜: 02-880-5338")

selected_sport = ""
reason = ""

if method == "ì™„ì „ ë¬´ìž‘ìœ„":
    affordable_sports = []
    for sport, price_dict in programs.items():
        if any(price <= budget for price in price_dict.values()):
            affordable_sports.append(sport)
    if not affordable_sports:
        st.error(f"ì˜ˆì‚° {budget:,}ì›ìœ¼ë¡œ ê°€ëŠ¥í•œ ìš´ë™ì´ ì—†ìŠµë‹ˆë‹¤.")
        st.stop()
    selected_sport = random.choice(affordable_sports)
    reason = "ë¬´ìž‘ìœ„ ì¶”ì²œìž…ë‹ˆë‹¤."
elif method == "MBTI ê¸°ë°˜":
    mbti = st.text_input("ë‹¹ì‹ ì˜ MBTIë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: INFJ)").strip().upper()
    if mbti in mbti_recommendations:
        selected_sport = mbti_recommendations[mbti]
        reason = mbti_explanations.get(mbti, "")
    elif mbti:
        st.error("ì•Œ ìˆ˜ ì—†ëŠ” MBTIìž…ë‹ˆë‹¤. ì •í™•ížˆ ìž…ë ¥í•´ì£¼ì„¸ìš”.")
elif method == "ìš´ë™ ëª©ì  ê¸°ë°˜":
    purpose = st.selectbox("ìš´ë™ ëª©ì  ë˜ëŠ” ì¦ìƒ", list(purpose_recommendations.keys()))
    selected_sport = random.choice(purpose_recommendations[purpose])
    reason = "í•´ë‹¹ ëª©ì ì— ê¸°ë°˜í•œ ì¶”ì²œìž…ë‹ˆë‹¤."
elif method == "ì§ì ‘ ì„ íƒ":
    selected_sport = st.selectbox("ìš´ë™ ì§ì ‘ ì„ íƒ", list(programs.keys()))
    reason = "ì‚¬ìš©ìž ì§ì ‘ ì„ íƒìž…ë‹ˆë‹¤."



if selected_sport:
    st.subheader(":trophy: ì¶”ì²œ ê²°ê³¼")
    st.write(f"**ìš´ë™ í”„ë¡œê·¸ëž¨:** {selected_sport}")
    st.write(f"**ì¶”ì²œ ì‚¬ìœ :** {reason}")

    prices = programs[selected_sport]
    available_options = {k: v for k, v in prices.items() if v <= budget}

    if not available_options:
        st.error(f"ì˜ˆì‚° {budget:,}ì›ìœ¼ë¡œëŠ” {selected_sport} í”„ë¡œê·¸ëž¨ì˜ ì´ìš©ê¶Œì´ ì—†ìŠµë‹ˆë‹¤.")
        st.stop()

    # ê°€ìž¥ ë¹„ì‹¼ ì´ìš©ê¶Œ ì¶”ì²œ
    sorted_options = sorted(available_options.items(), key=lambda x: -x[1])
    ticket, price = sorted_options[0]

    st.success(f"ì¶”ì²œ ì´ìš©ê¶Œ: {ticket} ({price:,}ì›)")

    st.markdown("### ðŸ’° ì´ìš©ê¶Œ ê°€ê²©í‘œ")
    for key, value in prices.items():
        st.write(f"- {key}: {value:,}ì›")

    if selected_sport in sport_tips:
        st.markdown("### âš ï¸ ìš´ë™ ì‹œ ì£¼ì˜ì‚¬í•­")
        for tip in sport_tips[selected_sport]:
            st.markdown(f"- {tip}")
